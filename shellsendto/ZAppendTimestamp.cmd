@echo off
powershell $argFile = '%1';$dq = ([char]0x0022).ToString();if(!(Test-Path($argFile))){echo 'No such file';Exit;}$lastbackslash =  $argFile.LastIndexOf('\');$lastdot = $argFile.LastIndexOf('.');if($lastdot -gt $lastbackslash){$output = $argFile.Remove($lastdot) + (Get-Date).ToString('yyyyMMddHHmmss') + '.7z';}else{$output = $argFile + (Get-Date).ToString('yyyyMMddHHmmss')+ '.7z';}$sevenzg = [System.IO.Path]::Combine([System.Environment]::GetEnvironmentVariable('programW6432'),'7-Zip\7zG.exe');if(!(Test-Path($sevenzg))){$sevenzg = [System.IO.Path]::Combine([System.Environment]::GetEnvironmentVariable('programfiles'),'7-Zip\7zG.exe');if(!(Test-Path($sevenzg))){$sevenzg = [System.IO.Path]::Combine([System.Environment]::GetEnvironmentVariable('programfiles(x86)'),'7-Zip\7zG.exe');if(!(Test-Path($sevenzg))){echo '7z not installed.'Exit;}}}if(Test-Path($output)){echo 'Filename exists (Rare exception)';Exit;}start $sevenzg ('a -mx=9 ' +$dq+ $output + $dq+' '+$dq + $argFile+$dq);